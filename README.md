# rnaaln
ICGC ARGO Workflow for RNA-Seq Alignment

## 1. Parameters
### 1.1 Required Parameters (configured in conf/test_local.config, conf/test_rdpc.config)
#### 1.1.1 Both rdpc and local mode
  * reference_fasta="PATH/TO/genome.fa"
  * reference_fai = "PATH/TO/genome.fa.fai"
  * reference_gtf = "PATH/TO/annotation.gtf"
  * reference_splicesites = "PATH/TO/splicesites.txt"
  * rrna_intervals = "PATH/TO/rRNA.interval_list"
  * ref_flat = "PATH/TO/refFlat.hg38.txt.gz"
  * hisat2_index = "PATH/TO/genome.index_HISAT2"
  * star_index = "PATH/TO/genome.index_STAR"
  * genome_build = "GRCh38_Verily_v1"
  * genome_annotation = "GENCODE v40"
#### 1.1.2 RDPC mode
  * analysis_id="8421ae71-e25e-47ba-a1ae-71e25e87bae2"
  * study_id="TCRB-CA"
#### 1.1.3 Local mode
  * samplesheet="PATH/TO/SAMPLESHEET.csv"
    
### 1.2 Optional Parameters (configured in conf/test_rdpc.config)
   * reference_trans_fasta = "${projectDir}/test/reference/test_transcript.fa"
   * reference_trans_fai = "${projectDir}/test/reference/test_transcript.fa.fai"

Transcriptome reference files are used in `star_aln` pipeline to generate transcriptome based alignemnts. The transcriptome reference fasta and fai file can be provided. If not, they will be generated by genome fasta and gtf files. 

## Tools
  * hisat2_aln
  * star_aln
  * markdup
  * cleanup

One or more tools can be specified in the command line.

## Minimal tests

```
nextflow run main.nf -profile docker,test_local --tools hisat2_aln,star_aln,markdup
```

## RDPC_qa tests
full test
```
nextflow run main.nf -profile docker,test_rdpc,rdpc_qa --tools hisat2_aln,star_aln,markdup,cleanup --api_token ####
```
without cleanup
```
nextflow run main.nf -profile docker,test_rdpc,rdpc_qa --tools hisat2_aln,star_aln,markdup --api_token ####
```
without markdup
```
nextflow run main.nf -profile docker,test_rdpc,rdpc_qa --tools hisat2_aln,star_aln,cleanup --api_token ####
```
with only hisat2
```
nextflow run main.nf -profile docker,test_rdpc,rdpc_qa --tools hisat2_aln,markdup,cleanup --api_token ####
```
with only star
```
nextflow run main.nf -profile docker,test_rdpc,rdpc_qa --tools hisat2_aln,star_aln,markdup,cleanup --api_token ####
```
without transcriptome reference

First, comment out `reference_trans_fasta` and `reference_trans_fai` in conf/test_rdpc.config; Second, run:
```
nextflow run main.nf -profile docker,test_rdpc,rdpc_qa --tools hisat2_aln,star_aln,markdup,cleanup --api_token ####
```
